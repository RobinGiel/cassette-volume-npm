!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("react"),require("prop-types")):"function"==typeof define&&define.amd?define(["react","prop-types"],t):"object"==typeof exports?exports.cassetteCore=t(require("react"),require("prop-types")):e.cassetteCore=t(e.React,e.PropTypes)}("undefined"!=typeof self?self:this,function(e,t){return function(e){var t={};function n(s){if(t[s])return t[s].exports;var i=t[s]={i:s,l:!1,exports:{}};return e[s].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,s){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(n.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(s,i,function(t){return e[t]}.bind(null,i));return s},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/dist",n(n.s=7)}([function(t,n){t.exports=e},function(e,n){e.exports=t},function(e,t,n){"use strict";n.d(t,"a",function(){return i}),n.d(t,"b",function(){return a});const s=console.log.bind(console),i=console.error?console.error.bind(console):s,a=console.warn?console.warn.bind(console):s},function(e,t,n){"use strict";(function(e){var s=n(0),i=n(2);const a=n(6).version,r="undefined"==typeof window?e:window;r.__cassette_contexts__=r.__cassette_contexts__||{},t.a=function(e){let t=e.displayName,n=e.defaultValue,o=void 0===n?null:n,l=e.keysWillUpdate;const c=r.__cassette_contexts__[t];if(c)return c.packageVersion!==a&&Object(i.b)(`Warning: multiple versions of ${t} from the @cassette/core`+` package have been loaded. v${a} will be ignored and`+` v${c.packageVersion} will be used instead.`),c;const d={};let u=0;for(const e of l)d[e]=1<<u++;const h=Object(s.createContext)(o,function(e,t){let n=0;for(const s of l)e[s]!==t[s]&&(n|=d[s]);return n});return h.__cassetteGetObservedBits=(e=>{let t=0;for(const n of e)t|=d[n];return t}),h.displayName=t,h.packageVersion=a,r.__cassette_contexts__[t]=h,h}}).call(this,n(5))},function(e,t,n){"use strict";e.exports=function(e,t,n){if("function"==typeof Array.prototype.findIndex)return e.findIndex(t,n);if("function"!=typeof t)throw new TypeError("predicate must be a function");var s=Object(e),i=s.length;if(0===i)return-1;for(var a=0;a<i;a++)if(t.call(n,s[a],a,s))return a;return-1}},function(e,t){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e){e.exports={name:"@cassette/core",version:"2.0.0-alpha.33",description:"A simple, clean, and responsive visual wrapper for the HTML audio tag, built with React.",main:"dist/es5/cassette-core.js",scripts:{"build:clean":"rimraf dist","build:webpack":"BUILD_MODE=all webpack --progress",build:"npm run build:clean && npm run build:webpack",prepare:"npm run build",test:'echo "Error: no test specified" && exit 1'},repository:{type:"git",url:"https://github.com/benwiley4000/cassette.git"},engines:{node:">=6.0.0",npm:">=5.0.0"},keywords:["audio","video","media","ui","react","reactjs","responsive","music","player","html5","component","components"],author:{name:"Ben Wiley",email:"therealbenwiley@gmail.com",url:"http://benwiley.org/"},license:"MIT",peerDependencies:{react:"^16.3.0"},devDependencies:{"array-find-index":"^1.0.2",rimraf:"^2.5.4",webpack:"^4.17.1"},dependencies:{"prop-types":"^15.5.10"},publishConfig:{access:"public"},gitHead:"3ea7031e7a4b7cec3628fc0b07bc311003c0d51d"}},function(e,t,n){"use strict";n.r(t);var s={};n.r(s),n.d(s,"controlKeyword",function(){return g}),n.d(s,"control",function(){return y}),n.d(s,"crossOriginAttribute",function(){return b}),n.d(s,"repeatStrategy",function(){return k}),n.d(s,"mediaSource",function(){return v}),n.d(s,"mediaSessionAction",function(){return S}),n.d(s,"mediaSessionArtwork",function(){return T}),n.d(s,"track",function(){return E}),n.d(s,"progressDirection",function(){return P}),n.d(s,"seekMode",function(){return x}),n.d(s,"aspectRatio",function(){return w});var i=n(0),a=n.n(i),r=n(4),o=n.n(r),l=n(3),c=Object(l.a)({displayName:"PlayerContext",keysWillUpdate:["playlist","activeTrackIndex","trackLoading","paused","currentTime","seekPreviewTime","seekInProgress","awaitingPlayResume","duration","bufferedRanges","playedRanges","seekableRanges","volume","muted","shuffle","stalled","playbackRate","setVolumeInProgress","repeatStrategy","mediaCannotPlay"]}),d=Object(l.a)({displayName:"GroupContext",keysWillUpdate:["groupProps"]}),u=n(1),h=n.n(u);const p=["none","playlist","track"];var m=n(2);function f(e,t){let n=!1;return function(s,i,a){if(i in s){!n&&t in s&&(Object(m.b)(`Do not define both the '${i}' and '${t}' props.`),n=!0);for(var r=arguments.length,o=new Array(r>3?r-3:0),l=3;l<r;l++)o[l-3]=arguments[l];return e.isRequired(s,i,a,...o)}if(!(t in s))return new Error(`If the '${t}' prop is not defined, '${i}' must be.`)}}const g=h.a.oneOf(["playpause","backskip","forwardskip","volume","mute","repeat","shuffle","progress","progressdisplay","fullscreen","spacer"]),y=h.a.oneOfType([h.a.func,g]),b=h.a.oneOf(["anonymous","use-credentials"]),k=h.a.oneOf(p),v=h.a.shape({src:h.a.string.isRequired,type:h.a.string.isRequired}),S=h.a.oneOf(["play","pause","previoustrack","nexttrack","seekbackward","seekforward"]),T=h.a.shape({src:h.a.string.isRequired,sizes:h.a.string,type:h.a.string}),E=h.a.shape({url:f(h.a.string,"sources"),sources:f(h.a.arrayOf(v.isRequired),"url"),title:h.a.string.isRequired,artist:h.a.string,album:h.a.string,artwork:h.a.arrayOf(T.isRequired),duration:h.a.oneOfType([h.a.string,h.a.number]),startingTime:h.a.number,isUnboundedStream:h.a.bool,meta:h.a.object}),P=h.a.oneOf(["left","right","up","down"]),x=h.a.oneOf(["paused","immediate","onrelease"]);function w(e,t){const n=e[t];if(void 0!==n)return"string"!=typeof n||2!==n.split(":").length||n.split(":").some(isNaN)?new Error(`The ${t} prop should be a string of the form 'x:y'. Example: 16:9`):void 0}const M="loopchange",O="srcrequest";var C=function(e){return new MutationObserver(()=>{e.dispatchEvent(new Event(M))}).observe(e,{attributes:!0,attributeFilter:["loop"]}),Object.defineProperty(e,"src",{get:()=>e.currentSrc,set:t=>{const n=new Event(O);n.srcRequested=t,e.dispatchEvent(n)}}),e};function _(e,t,n,s){let i=s;for(let s=0;s<e;s++){if(!t.length)throw _(s,n,t,i),`Moving ${e} places was not possible!`;n.push(i),i=t.pop()}return i}function L(e,t,n,s,i){let a,r=s;if(e.length){for(let s=1;s<=t.length;s++)if(-1!==e.indexOf(t[t.length-s]))return _(s,t,n,r);if(i){if(function(e,t){if(!e.length)return!1;for(let n=0;n<e.length;n++)if(t!==e[n])return!1;return!0}(e,r))return r;do{a=e[Math.floor(Math.random()*e.length)]}while(r===a||void 0===a);return void 0!==(r=_(t.length,t,n,r))&&n.push(r),a}}}var I=class{constructor(e,t){void 0===t&&(t={}),this._list=e,this._forwardStack=[],this._backStack=[],this._currentItem=void 0,this._allowBackShuffle=Boolean(t.allowBackShuffle)}findNextItem(e){return void 0!==e&&this.setCurrentIndex(e),this._currentItem=L(this._list,this._forwardStack,this._backStack,this._currentItem,!0),this._currentItem}findPreviousItem(e){return void 0!==e&&this.setCurrentIndex(e),this._currentItem=L(this._list,this._backStack,this._forwardStack,this._currentItem,this._allowBackShuffle),this._currentItem}pickNextItem(e,t){if(void 0!==t&&this.setCurrentIndex(t),void 0!==this._list[e])return void 0!==this._currentItem&&this._backStack.push(this._currentItem),this._forwardStack.length=0,this._currentItem=this._list[e],this._currentItem}setList(e){this._list=e}setOptions(e){for(const t of Object.keys(e))switch(t){case"allowBackShuffle":this[`_${t}`]=Boolean(e[t])}}setCurrentIndex(e){const t=this._list[e];this._currentItem!==t&&(this.clear(),this._currentItem=t)}clear(){this._forwardStack.length=0,this._backStack.length=0,this._currentItem=void 0}};var R=function(e){return Boolean(e&&e.length)};const F=[{src:""}];var j=function(e,t){if(!R(e))return F;const n=e[t],s=n.sources,i=n.url;return s?s.length?s:F:[{src:i}]};var V=function(e,t){return o()(e,e=>e.sources?-1!==o()(e.sources,e=>e.src===t):e.url&&t===e.url)};function q(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const H="__highly_unstable_snapshot_internals_which_will_break_your_app_if_you_use_them_directly__",A="__cassette_snapshot_version__",B=[e=>{const t=e.__unstable__;return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},s=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(s=s.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),s.forEach(function(t){q(e,t,n[t])})}return e}({},function(e,t){if(null==e)return{};var n,s,i={},a=Object.keys(e);for(s=0;s<a.length;s++)n=a[s],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,["__unstable__"]),{[H]:t})}];var N=function(e){return(e||[]).map((t,n)=>j(e,n)[0].src)};var D=function(e){const t=Array(e.length);for(let n=0;n<e.length;n++)t[n]={start:e.start(n),end:e.end(n)};return t};var U=function(e,t){return e?"track":t?"playlist":"none"};var $=function(e,t,n){return t="number"==typeof t?t:-1/0,n="number"==typeof n?n:1/0,Math.max(t,Math.min(e,n))};var W=function(e){return e?e.displayText?e.displayText:e.title&&e.artist?`${e.artist} - ${e.title}`:e.title||e.artist||e.album||"":""};var z=function(e){let t=0,n=1;const s=e.split(":").slice(-3);for(;s.length>0;)t+=n*parseInt(s.pop(),10),n*=60;return t};var K=function(e){let t=0;return e.duration&&(t="string"==typeof e.duration?z(e.duration):e.duration),t};function G(){return(G=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e}).apply(this,arguments)}function J(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},s=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(s=s.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),s.forEach(function(t){Q(e,t,n[t])})}return e}function Q(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function X(e){if(Object(m.a)(e),"NotAllowedError"===e.name){const e="Media playback failed at "+(new Date).toLocaleTimeString()+"! (Perhaps autoplay is disabled in this browser.)";Object(m.b)(e)}}const Y=["previoustrack","nexttrack","seekbackward","seekforward"],Z={paused:!0,currentTime:0,seekPreviewTime:0,seekInProgress:!1,awaitingResumeOnSeekComplete:!1,awaitingPlayAfterTrackLoad:!1,duration:0,bufferedRanges:[],playedRanges:[],seekableRanges:[],stalled:!1,shouldRequestPlayOnNextUpdate:!1,mediaCannotPlay:!1,maxKnownTime:0};function ee(e){let t=e.prevState,n=e.index,s=e.track,i=e.shouldPlay,a=void 0===i||i,r=e.shouldForceLoad,o=void 0!==r&&r;const l=t.activeTrackIndex!==n,c=Boolean(l||o),d=s.startingTime||0;return{duration:K(s),activeTrackIndex:n,trackLoading:c,mediaCannotPlay:t.mediaCannotPlay&&!c,currentTime:$(d,0),loop:!c&&t.loop,shouldRequestPlayOnNextUpdate:Boolean(a),awaitingPlayAfterTrackLoad:Boolean(a),awaitingForceLoad:Boolean(o),maxKnownTime:c?0:t.maxKnownTime}}class te extends i.Component{constructor(e){super(e);let t=0;const n=$(e.startingTrackIndex,0),s=R(e.playlist);s&&e.playlist[n]&&(t=e.playlist[n].startingTime||0);const i=e.initialStateSnapshot;let a={};if(i)try{a=function(e,t){const n=B.slice(e[A]||0).reduce((e,t)=>t(e),e)[H],s=n.paused,i=n.currentTime,a=n.activeTrackIndex,r=n.volume,o=n.muted,l=n.loop,c=n.cycle,d=n.shuffle,u=n.playbackRate,h=n.activeTrackSrc,p={};R(t.playlist)&&"boolean"==typeof s&&(p.awaitingPlay=!s),"number"==typeof r&&r>=0&&r<=1&&(p.volume=r),"boolean"==typeof o&&(p.muted=o),"boolean"==typeof l&&(p.loop=l),"boolean"==typeof c&&(p.cycle=c),"boolean"==typeof d&&(p.shuffle=d),"number"==typeof u&&(p.playbackRate=u);let m=!1;if("string"==typeof h&&"number"==typeof a&&a>=0){const e=t.playlist[a]&&j(t.playlist,a)[0].src;if(e&&h===e)p.activeTrackIndex=a,m=!0;else{const e=V(t.playlist,h);-1!==e&&(p.activeTrackIndex=e,m=!0)}}return m&&"number"==typeof i&&i>=0&&(p.currentTime=i),p}(i,e)}catch(e){Object(m.b)(e),Object(m.b)("Loading Cassette state from snapshot failed."),Object(m.b)(`Failed snapshot:\n${JSON.stringify(i,null,2)}`)}this.state=J({},Z,{activeTrackIndex:n,trackLoading:R(e.playlist),currentTime:$(t,0),volume:$(e.defaultVolume,0,1),muted:e.defaultMuted,loop:"track"===e.defaultRepeatStrategy,cycle:"playlist"===e.defaultRepeatStrategy,shuffle:e.defaultShuffle,playbackRate:e.defaultPlaybackRate,setVolumeInProgress:!1,shouldRequestPlayOnNextUpdate:e.autoplay&&s,awaitingForceLoad:!1,duration:K(s&&e.playlist[n]),__playlist__:e.playlist},a),this.lastStableVolume=this.state.volume,this.shuffler=new I(N(e.playlist),{allowBackShuffle:e.allowBackShuffle}),this.media=null,this.videoHostElementList=[],this.videoHostOccupiedCallbacks=new Map,this.videoHostVacatedCallbacks=new Map,this.handleTrackPlaybackFailure=this.handleTrackPlaybackFailure.bind(this),this.togglePause=this.togglePause.bind(this),this.selectTrackIndex=this.selectTrackIndex.bind(this),this.forwardSkip=this.forwardSkip.bind(this),this.backSkip=this.backSkip.bind(this),this.seekPreview=this.seekPreview.bind(this),this.seekComplete=this.seekComplete.bind(this),this.setVolume=this.setVolume.bind(this),this.setVolumeComplete=this.setVolumeComplete.bind(this),this.toggleMuted=this.toggleMuted.bind(this),this.toggleShuffle=this.toggleShuffle.bind(this),this.setRepeatStrategy=this.setRepeatStrategy.bind(this),this.setPlaybackRate=this.setPlaybackRate.bind(this),this.registerVideoHostElement=this.registerVideoHostElement.bind(this),this.renderVideoIntoHostElement=this.renderVideoIntoHostElement.bind(this),this.unregisterVideoHostElement=this.unregisterVideoHostElement.bind(this),this.updateVideoHostElement=this.updateVideoHostElement.bind(this),this.handleMediaPlay=this.handleMediaPlay.bind(this),this.handleMediaPause=this.handleMediaPause.bind(this),this.handleMediaSrcrequest=this.handleMediaSrcrequest.bind(this),this.handleMediaEnded=this.handleMediaEnded.bind(this),this.handleMediaEmptied=this.handleMediaEmptied.bind(this),this.handleMediaStalled=this.handleMediaStalled.bind(this),this.handleMediaCanplaythrough=this.handleMediaCanplaythrough.bind(this),this.handleMediaCanplay=this.handleMediaCanplay.bind(this),this.handleMediaTimeupdate=this.handleMediaTimeupdate.bind(this),this.handleMediaLoadeddata=this.handleMediaLoadeddata.bind(this),this.handleMediaVolumechange=this.handleMediaVolumechange.bind(this),this.handleMediaDurationchange=this.handleMediaDurationchange.bind(this),this.handleMediaProgress=this.handleMediaProgress.bind(this),this.handleMediaLoopchange=this.handleMediaLoopchange.bind(this),this.handleMediaRatechange=this.handleMediaRatechange.bind(this)}componentDidMount(){const e=this.media=C(this.props.createMediaElement()),t=this.props,n=t.defaultPlaybackRate,s=t.crossOrigin,i=t.playlist,a=t.autoplayDelayInSeconds,r=t.mediaElementRef,o=t.getPosterImageForTrack,l=t.getMediaTitleAttributeForTrack,c=t.onActiveTrackUpdate,d=this.state,u=d.volume,h=d.muted,p=d.playbackRate,m=d.loop,f=d.activeTrackIndex,g=d.shouldRequestPlayOnNextUpdate;e.defaultPlaybackRate=n,s&&(e.crossOrigin=s),e.volume=u,e.muted=h,e.playbackRate=p,e.loop=m,e.setAttribute("playsinline",""),e.setAttribute("webkit-playsinline",""),e.setAttribute("preload","metadata"),e.setAttribute("poster",o(i[f])),e.setAttribute("title",l(i[f])),e.addEventListener("play",this.handleMediaPlay),e.addEventListener("pause",this.handleMediaPause),e.addEventListener("ended",this.handleMediaEnded),e.addEventListener("stalled",this.handleMediaStalled),e.addEventListener("emptied",this.handleMediaEmptied),e.addEventListener("canplay",this.handleMediaCanplay),e.addEventListener("canplaythrough",this.handleMediaCanplaythrough),e.addEventListener("timeupdate",this.handleMediaTimeupdate),e.addEventListener("loadeddata",this.handleMediaLoadeddata),e.addEventListener("volumechange",this.handleMediaVolumechange),e.addEventListener("durationchange",this.handleMediaDurationchange),e.addEventListener("progress",this.handleMediaProgress),e.addEventListener("ratechange",this.handleMediaRatechange),e.addEventListener("srcrequest",this.handleMediaSrcrequest),e.addEventListener("loopchange",this.handleMediaLoopchange),this.setMediaElementSources(),this.mediaContainer.appendChild(e),g&&(this.setState({shouldRequestPlayOnNextUpdate:!1}),this.delayTimeout=setTimeout(()=>{this.togglePause(!1)},1e3*a)),r&&r(e),c&&c({track:i[f],trackIndex:f,previousTrack:null,previousTrackIndex:null})}static getDerivedStateFromProps(e,t){const n=e.playlist;if(n===t.__playlist__)return null;const s={__playlist__:n};if(!R(n))return J({},Z,s,{activeTrackIndex:0,trackLoading:!1});const i=j(t.__playlist__,t.activeTrackIndex);if(n[t.activeTrackIndex]){const e=j(n,t.activeTrackIndex);if(i[0].src===e[0].src)return s}const a=V(n,i[0].src);return-1!==a?J({},s,{activeTrackIndex:a}):J({},s,ee({prevState:t,track:n[0],index:0,shouldPlay:!1,shouldForceLoad:!0}),{mediaCannotPlay:!1,awaitingPlayAfterTrackLoad:!1})}componentDidUpdate(e,t){this.media.defaultPlaybackRate=this.props.defaultPlaybackRate,this.media.crossOrigin=this.props.crossOrigin,this.shuffler.setList(N(this.props.playlist)),this.shuffler.setOptions({allowBackShuffle:this.props.allowBackShuffle});const n=j(e.playlist,t.activeTrackIndex),s=j(this.props.playlist,this.state.activeTrackIndex),i=e.playlist[t.activeTrackIndex],a=this.props.playlist[this.state.activeTrackIndex];(this.state.awaitingForceLoad||n[0].src!==s[0].src)&&(this.setMediaElementSources(),this.media.setAttribute("poster",this.props.getPosterImageForTrack(a)),this.media.setAttribute("title",this.props.getMediaTitleAttributeForTrack(a)),this.setState({awaitingForceLoad:!1}),this.state.shuffle||this.shuffler.clear()),this.props.onActiveTrackUpdate&&i!==a&&this.props.onActiveTrackUpdate({track:a,trackIndex:this.state.activeTrackIndex,previousTrack:i,previousTrackIndex:t.activeTrackIndex}),e===this.props||this.media.paused||this.stealMediaSession(),this.state.shouldRequestPlayOnNextUpdate&&(this.setState({shouldRequestPlayOnNextUpdate:!1}),setTimeout(()=>{this.togglePause(!1)})),clearTimeout(this.snapshotUpdateTimeout),this.snapshotUpdateTimeout=setTimeout(()=>{this.props.onStateSnapshot&&this.props.onStateSnapshot(function(e){const t=e.paused,n=e.currentTime,s=e.activeTrackIndex,i=e.volume,a=e.muted,r=e.loop,o=e.cycle,l=e.shuffle,c=e.playbackRate,d=e.duration,u=e.__playlist__;return{[A]:B.length,[H]:{paused:t,currentTime:d===1/0?0:n,activeTrackIndex:s,volume:i,muted:a,loop:r,cycle:o,shuffle:l,playbackRate:c,activeTrackSrc:R(u)?j(u,s)[0].src:null}}}(this.state))},100)}componentWillUnmount(){const e=this.media;if(e){e.removeEventListener("play",this.handleMediaPlay),e.removeEventListener("pause",this.handleMediaPause),e.removeEventListener("ended",this.handleMediaEnded),e.removeEventListener("stalled",this.handleMediaStalled),e.removeEventListener("emptied",this.handleMediaEmptied),e.removeEventListener("canplaythrough",this.handleMediaCanplaythrough),e.removeEventListener("canplay",this.handleMediaCanplay),e.removeEventListener("timeupdate",this.handleMediaTimeupdate),e.removeEventListener("loadeddata",this.handleMediaLoadeddata),e.removeEventListener("volumechange",this.handleMediaVolumechange),e.removeEventListener("durationchange",this.handleMediaDurationchange),e.removeEventListener("progress",this.handleMediaProgress),e.removeEventListener("ratechange",this.handleMediaRatechange),e.removeEventListener("srcrequest",this.handleMediaSrcrequest),e.removeEventListener("loopchange",this.handleMediaLoopchange);const t=e.querySelectorAll("source");for(const e of t)e.removeEventListener("error",this.handleTrackPlaybackFailure)}clearTimeout(this.gapLengthTimeout),clearTimeout(this.delayTimeout)}stealMediaSession(){window.MediaSession&&navigator.mediaSession instanceof MediaSession&&(navigator.mediaSession.metadata=new MediaMetadata(this.props.playlist[this.state.activeTrackIndex]),Y.map(e=>{if(-1===this.props.supportedMediaSessionActions.indexOf(e))return null;const t=this.props.mediaSessionSeekLengthInSeconds;switch(e){case"play":return this.togglePause.bind(this,!1);case"pause":return this.togglePause.bind(this,!0);case"previoustrack":return this.backSkip;case"nexttrack":return this.forwardSkip;case"seekbackward":return()=>this.media.currentTime-=t;case"seekforward":return()=>this.media.currentTime+=t;default:return}}).forEach((e,t)=>{navigator.mediaSession.setActionHandler(Y[t],e)}))}setMediaElementSources(){const e=this.props.playlist;let t;for(;t=this.media.firstChild;)this.media.removeChild(t);if(R(e)){const t=j(e,this.state.activeTrackIndex);for(const e of t){const t=document.createElement("source");t.src=e.src,e.type&&(t.type=e.type),t.addEventListener("error",this.handleTrackPlaybackFailure),this.media.appendChild(t)}}this.media.load()}handleTrackPlaybackFailure(e){this.setState({mediaCannotPlay:!0}),this.props.onTrackPlaybackFailure&&this.props.onTrackPlaybackFailure({track:this.props.playlist[this.state.activeTrackIndex],trackIndex:this.state.activeTrackIndex,event:e})}registerVideoHostElement(e,t){let n=t.onHostOccupied,s=t.onHostVacated;this.videoHostElementList=this.videoHostElementList.concat(e),this.videoHostOccupiedCallbacks.set(e,n),this.videoHostVacatedCallbacks.set(e,s)}renderVideoIntoHostElement(e){-1!==this.videoHostElementList.indexOf(e)&&(cancelAnimationFrame(this.videoHostUpdateRaf),this.videoHostUpdateRaf=requestAnimationFrame(()=>this.updateVideoHostElement(e)))}unregisterVideoHostElement(e){this.videoHostElementList=this.videoHostElementList.filter(t=>t!==e),this.videoHostOccupiedCallbacks.delete(e),this.videoHostVacatedCallbacks.delete(e),this.media.parentNode===e&&this.updateVideoHostElement()}updateVideoHostElement(e){e?this.videoHostElementList=[e].concat(this.videoHostElementList.filter(t=>t!==e)):e=this.videoHostElementList[0]||this.mediaContainer;const t=!this.media.paused,n=this.media.parentNode;if(e===n)return;e.appendChild(this.media),t&&this.media.paused&&this.media.play();const s=this.videoHostVacatedCallbacks.get(n);s&&s(this.media);const i=this.videoHostOccupiedCallbacks.get(e);i&&i(this.media)}handleMediaPlay(){this.setState(e=>!1===e.paused&&!1===e.awaitingPlayAfterTrackLoad?null:{paused:!1,awaitingPlayAfterTrackLoad:!1}),this.stealMediaSession()}handleMediaPause(){this.setState(e=>!0===e.paused?null:{paused:!0})}handleMediaSrcrequest(e){const t=this.props.playlist,n=j(t,this.state.activeTrackIndex);if(-1!==o()(n,t=>t.src===e.srcRequested))return;const s=V(t,e.srcRequested);-1!==s?this.selectTrackIndex(s):Object(m.a)(`Source '${e.srcRequested}' does not exist in the loaded playlist. `+"Make sure you've updated the 'playlist' prop to PlayerContextProvider before you select this track!")}handleMediaEnded(){if(this.state.seekInProgress)return;clearTimeout(this.gapLengthTimeout);const e=this.props,t=e.playlist,n=e.loadFirstTrackOnPlaylistComplete;if(!R(t))return;const s=this.state,i=s.cycle,a=s.activeTrackIndex;!i&&a+1>=t.length?n&&this.goToTrack({index:0,track:t[0],shouldPlay:!1,shouldForceLoad:!0}):this.gapLengthTimeout=setTimeout(this.forwardSkip,1e3*this.props.gapLengthInSeconds)}handleMediaStalled(){this.setState(e=>!0===e.stalled?null:{stalled:!0})}handleMediaEmptied(){this.setState(e=>!0===e.paused?null:{paused:!0})}handleMediaCanplay(){this.setState(e=>!1===e.trackLoading?null:{trackLoading:!1})}handleMediaCanplaythrough(){this.setState(e=>!1===e.stalled?null:{stalled:!1})}handleMediaTimeupdate(){const e=this.media,t=e.currentTime,n=e.played,s=this.props,i=s.onTimeUpdate,a=s.playlist,r=this.state,o=r.activeTrackIndex;r.trackLoading||(this.setState(e=>({currentTime:t,playedRanges:D(n),maxKnownTime:Math.max(e.maxKnownTime,t)})),i&&i({currentTime:t,track:a[o],trackIndex:o}))}handleMediaLoadeddata(){this.media.currentTime!==this.state.currentTime&&(this.media.currentTime=this.state.currentTime)}handleMediaVolumechange(){const e=this.media,t=e.volume,n=e.muted;this.setState({volume:t,muted:n})}handleMediaDurationchange(){const e=this.media.duration,t=this.props.playlist[this.state.activeTrackIndex];if(e===1/0)if(t.isUnboundedStream||t===this.activeTrackAtLastDurationChange)this.setState({duration:e,currentTime:0}),this.media.currentTime=0;else{const e=this.state.paused;this.media.load(),e||setTimeout(()=>{this.togglePause(!1)})}else this.setState({duration:e});this.activeTrackAtLastDurationChange=t}handleMediaProgress(){this.setState({bufferedRanges:D(this.media.buffered),seekableRanges:D(this.media.seekable)})}handleMediaLoopchange(){const e=this.media.loop;this.setState(t=>t.loop===e?null:{loop:e})}handleMediaRatechange(){const e=this.media.playbackRate;this.setState(t=>t.playbackRate===e?null:{playbackRate:e})}togglePause(e){if(clearTimeout(this.delayTimeout),"boolean"==typeof e?e:!this.state.paused)this.media.pause();else if(this.media.currentSrc)try{const e=this.media.play();e&&"function"==typeof e.catch&&e.catch(e=>{if("AbortError"!==e.name)return Promise.reject(e)}).catch(X)}catch(e){X(e)}}goToTrack(e){clearTimeout(this.delayTimeout),this.setState(t=>ee(J({prevState:t},e)))}selectTrackIndex(e){const t=this.props.playlist;R(t)&&(e<0||e>t.length?Object(m.b)(`Playlist index ${e} is out of bounds!`):(this.state.shuffle&&this.shuffler.pickNextItem(e,this.state.activeTrackIndex),this.goToTrack({index:e,track:t[e]})))}backSkip(){const e=this.props,t=e.playlist,n=e.stayOnBackSkipThreshold,s=this.media,i=this.state,a=i.cycle,r=i.activeTrackIndex,o=i.shuffle;if(!R(t)||s.currentTime>=n||!a&&r<1)return void(s.currentTime=0);let l;if(o){const e=this.shuffler.findPreviousItem(r);if(void 0===e)return void(s.currentTime=0);l=V(t,e)}else(l=r-1)<0&&(l=t.length-1);this.goToTrack({index:l,track:t[l],shouldForceLoad:!0})}forwardSkip(){const e=this.props.playlist,t=this.state,n=t.cycle,s=t.activeTrackIndex,i=t.shuffle;if(!R(e)||!n&&s+1>=e.length)return;let a;i?a=V(e,this.shuffler.findNextItem(s)):(a=s+1)>=e.length&&(a=0),this.goToTrack({index:a,track:e[a],shouldForceLoad:!0})}seekPreview(e){if(!R(this.props.playlist))return;const t={seekPreviewTime:e,seekInProgress:!0};switch(this.props.seekMode){case"paused":this.setState(n=>{let s=n.paused,i=n.awaitingResumeOnSeekComplete;return J({},t,{awaitingResumeOnSeekComplete:!s||i,currentTime:e})}),this.state.trackLoading||(this.media.currentTime=e),this.state.paused||this.togglePause(!0);break;case"immediate":this.setState(n=>{let s=n.paused,i=n.awaitingResumeOnSeekComplete;return J({},t,{awaitingResumeOnSeekComplete:!s||i,currentTime:e})}),this.state.trackLoading||(this.media.currentTime=e),this.state.awaitingResumeOnSeekComplete&&!this.media.ended&&this.togglePause(!1);break;case"onrelease":this.setState(t)}}seekComplete(e){const t=this.state,n=t.seekPreviewTime,s=t.awaitingResumeOnSeekComplete,i=t.trackLoading,a={seekInProgress:!1,awaitingResumeOnSeekComplete:!1},r="number"==typeof e?e:n;isNaN(r)?this.setState(a):(this.setState(J({},a,{currentTime:r})),i||(this.media.currentTime=r),s&&(this.media.ended?this.forwardSkip():this.togglePause(!1)))}setVolume(e,t){void 0===t&&(t=!0),t&&!this.state.setVolumeInProgress&&this.setState({setVolumeInProgress:!0});const n=$(e,0,1);this.media.muted=0===n,this.media.volume=n}setVolumeComplete(e){"number"==typeof e&&this.setVolume(e,!1),this.setState({setVolumeInProgress:!1}),this.media.muted||(this.lastStableVolume=this.media.volume)}toggleMuted(e){const t="boolean"==typeof e?e:!this.state.muted;this.media.muted=t,t||(this.media.volume=this.lastStableVolume)}toggleShuffle(e){const t="boolean"==typeof e?e:!this.state.shuffle;this.setState({shuffle:t})}setRepeatStrategy(e){if(-1!==p.indexOf(e))switch(e){case"track":this.media.loop=!0;break;case"playlist":this.setState({loop:!1,cycle:!0}),this.media.loop=!1;break;case"none":this.setState({loop:!1,cycle:!1}),this.media.loop=!1}else Object(m.b)('repeatStrategy "'+e+'" is not one of: '+p.split(", ")+".")}setPlaybackRate(e){this.media.playbackRate=e}getControlProps(){const e=this.props,t=this.state,n={playlist:e.playlist,activeTrackIndex:t.activeTrackIndex,trackLoading:t.trackLoading,paused:t.paused,currentTime:t.currentTime,seekPreviewTime:t.seekPreviewTime,seekInProgress:t.seekInProgress,awaitingPlayResume:t.awaitingResumeOnSeekComplete||t.awaitingPlayAfterTrackLoad,duration:t.duration===1/0?t.maxKnownTime:t.duration,bufferedRanges:t.bufferedRanges,playedRanges:t.playedRanges,seekableRanges:t.seekableRanges,volume:t.volume,muted:t.muted,shuffle:t.shuffle,stalled:t.stalled,playbackRate:t.playbackRate,mediaCannotPlay:t.mediaCannotPlay,setVolumeInProgress:t.setVolumeInProgress,repeatStrategy:U(t.loop,t.cycle),registerVideoHostElement:this.registerVideoHostElement,renderVideoIntoHostElement:this.renderVideoIntoHostElement,unregisterVideoHostElement:this.unregisterVideoHostElement,onTogglePause:this.togglePause,onSelectTrackIndex:this.selectTrackIndex,onBackSkip:this.backSkip,onForwardSkip:this.forwardSkip,onSeekPreview:this.seekPreview,onSeekComplete:this.seekComplete,onSetVolume:this.setVolume,onSetVolumeComplete:this.setVolumeComplete,onToggleMuted:this.toggleMuted,onToggleShuffle:this.toggleShuffle,onSetRepeatStrategy:this.setRepeatStrategy,onSetPlaybackRate:this.setPlaybackRate};if(this.playerContext){for(const e of Object.keys(this.playerContext))if(n[e]!==this.playerContext[e]){this.playerContext=n;break}}else this.playerContext=n;return this.playerContext}render(){const e=this.getControlProps();return a.a.createElement(i.Fragment,null,a.a.createElement("div",{ref:e=>this.mediaContainer=e,hidden:!0}),a.a.createElement(c.Provider,{value:e},"function"==typeof this.props.children?this.props.children(e):this.props.children))}}te.defaultProps={autoplay:!1,autoplayDelayInSeconds:0,createMediaElement:()=>document.createElement("video"),gapLengthInSeconds:0,defaultVolume:1,defaultMuted:!1,defaultRepeatStrategy:"playlist",defaultShuffle:!1,defaultPlaybackRate:1,startingTrackIndex:0,loadFirstTrackOnPlaylistComplete:!0,seekMode:"immediate",maintainPlaybackRate:!1,allowBackShuffle:!1,stayOnBackSkipThreshold:5,supportedMediaSessionActions:["play","pause","previoustrack","nexttrack"],mediaSessionSeekLengthInSeconds:10,getPosterImageForTrack:e=>e&&e.artwork?e.artwork[0].src:"",getMediaTitleAttributeForTrack:W};class ne extends i.Component{componentDidMount(){this.props.groupContext.registerMediaElement(this.mediaElement)}componentWillUnmount(){this.mediaElement&&this.props.groupContext.unregisterMediaElement(this.mediaElement)}render(){const e=this.props,t=e.groupContext,n=e.props,s=n.mediaElementRef,i=function(e,t){if(null==e)return{};var n,s,i={},a=Object.keys(e);for(s=0;s<a.length;s++)n=a[s],t.indexOf(n)>=0||(i[n]=e[n]);return i}(n,["mediaElementRef"]);return a.a.createElement(te,G({},t.groupProps,i,{mediaElementRef:e=>{s&&s(e),this.mediaElement=e}}))}}var se=function(e){return a.a.createElement(d.Consumer,null,t=>t?Object(i.createElement)(ne,{groupContext:t,props:e}):Object(i.createElement)(te,e))};var ie=function(e){const t=[];let n=e._reactInternalFiber;if(!n)return t;for(;n=n._debugOwner;)n.type.name&&t.push(n.type.name);return t};var ae=class extends i.PureComponent{render(){const e=this.props,t=e.children,n=e.filterList;if(!n){if(!this.warnedAboutFilterList){let e="\n          Please pass the filterList prop to PlayerContextConsumer in order\n          to avoid unnecessarily frequent re-renders, e.g.\n\n          const filterList = ['paused', 'onTogglePause'];\n          // ...\n          <PlayerContextConsumer filterList={filterList}>\n            {({ paused, onTogglePause }) => {\n              return <div>{/* ... */}</div>;\n            }}\n          </PlayerContextConsumer>\n        ";for(const t of ie(this))e+=`\n            Rendered by ${t}`;Object(m.b)(e),this.warnedAboutFilterList=!0}return a.a.createElement(c.Consumer,null,t)}const s=c.__cassetteGetObservedBits(n);return a.a.createElement(c.Consumer,{unstable_observedBits:s},e=>{const s={};for(const t of n)e.hasOwnProperty(t)&&(s[t]=e[t]);return t(s)})}};function re(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},s=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(s=s.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),s.forEach(function(t){oe(e,t,n[t])})}return e}function oe(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var le=class extends i.Component{constructor(e){super(e),this.registerMediaElement=this.registerMediaElement.bind(this),this.unregisterMediaElement=this.unregisterMediaElement.bind(this),this.enforceOneMediaSourceOnly=this.enforceOneMediaSourceOnly.bind(this),this.mediaElements=[]}registerMediaElement(e){this.mediaElements=this.mediaElements.concat(e),e.addEventListener("play",this.enforceOneMediaSourceOnly,!0),e.addEventListener("volumechange",this.enforceOneMediaSourceOnly,!0)}unregisterMediaElement(e){this.mediaElements=this.mediaElements.filter(t=>e!==t),e.removeEventListener("play",this.enforceOneMediaSourceOnly,!0),e.removeEventListener("volumechange",this.enforceOneMediaSourceOnly,!0)}enforceOneMediaSourceOnly(e){const t=e.target,n=t.paused,s=t.muted;if(!n&&!s)for(const e of this.mediaElements)e===t||e.muted||e.pause()}render(){return a.a.createElement(d.Consumer,null,e=>{const t=e?re({},e,{groupProps:re({},e.groupProps,this.props)}):{groupProps:this.props,registerMediaElement:this.registerMediaElement,unregisterMediaElement:this.unregisterMediaElement};return a.a.createElement(d.Provider,{value:t},this.props.children)})}},ce=Object(l.a)({displayName:"FullscreenContext",defaultValue:{fullscreen:!1,requestFullscreen(){Object(m.b)("Fullscreen request ignored since there is no FullscreenContextProvider ancestor.")},requestExitFullscreen(){Object(m.b)("Exit fullscreen request ignored since there is no FullscreenContextProvider ancestor.")}},keysWillUpdate:["fullscreen"]});const de={width:"100%",height:"100%"};class ue extends i.PureComponent{constructor(e){super(e),this.state={fullscreen:!1},this.requestFullscreen=this.requestFullscreen.bind(this),this.requestExitFullscreen=this.requestExitFullscreen.bind(this),this.handleFullscreenChange=this.handleFullscreenChange.bind(this),this.fullscreenElement=null}componentDidMount(){document.addEventListener("fullscreenchange",this.handleFullscreenChange),document.addEventListener("webkitfullscreenchange",this.handleFullscreenChange),document.addEventListener("mozfullscreenchange",this.handleFullscreenChange),document.addEventListener("msfullscreenchange",this.handleFullscreenChange)}componentWillUnmount(){document.removeEventListener("fullscreenchange",this.handleFullscreenChange),document.removeEventListener("webkitfullscreenchange",this.handleFullscreenChange),document.removeEventListener("mozfullscreenchange",this.handleFullscreenChange),document.removeEventListener("msfullscreenchange",this.handleFullscreenChange)}requestFullscreen(){this.props.fullscreenEnabled&&(this.fullscreenElement.requestFullscreen?this.fullscreenElement.requestFullscreen():this.fullscreenElement.webkitRequestFullscreen?this.fullscreenElement.webkitRequestFullscreen():this.fullscreenElement.mozRequestFullscreen?this.fullscreenElement.mozRequestFullScreen():this.fullscreenElement.msRequestFullscreen&&this.fullscreenElement.msRequestFullscreen())}requestExitFullscreen(){document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.webkitCancelFullScreen?document.webkitCancelFullScreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen&&document.mozExitFullscreen()}handleFullscreenChange(){const e=document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement;this.setState({fullscreen:e===this.fullscreenElement})}getFullscreenContext(){const e={fullscreen:this.state.fullscreen,requestFullscreen:this.requestFullscreen,requestExitFullscreen:this.requestExitFullscreen};return this.fullscreenContext&&e.fullscreen===this.fullscreenContext.fullscreen?this.fullscreenContext:this.fullscreenContext=e}render(){const e=this.getFullscreenContext();return a.a.createElement("div",{ref:e=>this.fullscreenElement=e,style:this.state.fullscreen?de:void 0},a.a.createElement(ce.Provider,{value:e},"function"==typeof this.props.children?this.props.children(e):this.props.children))}}ue.defaultProps={fullscreenEnabled:!0};var he=ue;function pe(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var me=function(e,t){const n={},s=e.displayName||e.name,r=c.__cassetteGetObservedBits(t);function o(o){return a.a.createElement(ce.Consumer,null,l=>a.a.createElement(c.Consumer,{unstable_observedBits:r},a=>{const r=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},s=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(s=s.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),s.forEach(function(t){pe(e,t,n[t])})}return e}({},o);for(const e of t)a.hasOwnProperty(e)?r[e]=a[e]:l.hasOwnProperty(e)?r[e]=l[e]:n[e]||(Object(m.b)("Prop '"+e+"' for component "+s+" not found in playerContext or fullscreenContext."),n[e]=!0);return Object(i.createElement)(e,r)}))}return s&&(o.displayName=`PlayerContextFilter(${s})`),o};n.d(t,"FullscreenContextConsumer",function(){return fe}),n.d(t,"donotuse_PlayerContext",function(){return ge}),n.d(t,"donotuse_FullscreenContext",function(){return ye}),n.d(t,"PlayerContextProvider",function(){return se}),n.d(t,"PlayerContextConsumer",function(){return ae}),n.d(t,"PlayerContextGroup",function(){return le}),n.d(t,"FullscreenContextProvider",function(){return he}),n.d(t,"playerContextFilter",function(){return me}),n.d(t,"PlayerPropTypes",function(){return s}),n.d(t,"logError",function(){return m.a}),n.d(t,"logWarning",function(){return m.b}),n.d(t,"convertToNumberWithinIntervalBounds",function(){return $}),n.d(t,"isPlaylistValid",function(){return R}),n.d(t,"getDisplayText",function(){return W}),n.d(t,"repeatStrategyOptions",function(){return p});const fe=ce.Consumer,ge=c,ye=ce}])});
//# sourceMappingURL=cassette-core.min.js.map